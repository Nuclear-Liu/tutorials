# Mycat

> * 主从复制
> 
>     主从复制延时
> 
> * 读写分离
> 
>     读写分离划分原则
> 
> * 分库分表
> 
>     分库分表规则

MyCat 中间件目标：
* 高可用
* 负载均衡
* **SQL 解析路由**(`calcite`)

>ETL(抽取、转换、加载)，可以简单理解为：**数据清洗**

## 前置知识

分布式系统是指其组件分布在网络上，组件之间**通过传递消息进行通信和动作协调**的系统；
核心理念是让多个组件协同工作，完成单一组件无法完成的任务；

分布式系统特定点：
* **透明性**：分布式系统对用户透明，用户不必了解内部结构即能使用。
* **扩展性**：能根据需求动态扩展，既可以横向扩展使集群的整体性能获得线性提升，也可以纵向扩容，是的单个服务的性能获得提升。
* **可靠性**：容忍单点失效。
* **高性能**：分布式系统的初衷。

## 分布式数据库的实现原理

分布式数据库具有**逻辑整体性**、**物理分布性**；
物理分布性是数据库的实现变得更加复杂，数据划分后存储在不同的节点，为了保证可靠性，需要存储多个副本，所以产生了数据复制问题。
为了保证良好的性能，分布式数据库必须易于扩展；
所以分布式数据库在设计上需要实现：分布式数据库目录管理、数据分片、分布式查询处理、分布式并发控制、分布式锁管理、分布式存储、分布式网络架构、分布式安全管理等；

1. 分布式数据库目录管理

    分布式数据库的目录（数据的增删改查、用户授权、安全管理及并发控制等）存放着**系统元数据**及**数据库元数据**的全部信息。
    目录结构的合理性直接影响数据库的性能。

    分布式数据库的目录分为：**全局目录**、**分布式目录**、**全局与本地混合目录**。

2. 数据分片

    数据分片是指将数据全局地划分为响应的逻辑片段，有水平切分、垂直切分、混合切分三种类型。

    **水平切分**：按照某个字段的某种规则分散到多个节点库中。

    **垂直切分**：按照业务将表进行分类并分布到不同的节点上；

    **混合切分**：水平切分和垂直切分的结合；

3. 分布式查询处理

    分布式查询处理是把一个分布式数据库上的高层次查询映射到每个分布式节点上的操作，然后通过汇总各节点数据返回查询结果。

4. 分布式并发控制

    并发控制是分布式事务管理的基本任务之一，其目的是保证分布式数据库中的多个事务并发高效、正确的执行。

    并发控制的方法主要有三种：**加锁并发控制**、**时间戳控制**、**乐观并发控制**。
    * **加锁并发控制**：应用广泛，容易发生死锁；
    * **时间戳控制**：消除死锁，一旦发生冲突会重启而不是等待，需要全局统一时钟；
    * **乐观并发控制**对冲突较少的系统较为合适，对于冲突多的系统效率地下；
