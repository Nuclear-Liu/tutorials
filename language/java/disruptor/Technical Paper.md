# LMAX Disruptor：用于在并发线程之间交换数据的有界队列的高性能替代方案 (High performance alternative to bounded queues for exchanging data between concurrent threads)

> Martin Thompson · Dave Farley · Michael Barker · Patricia Gee · Andrew Stewart - Version 4.0.0.RC2-SNAPSHOT, May 2011

## 摘要 Abstract

LMAX 的成立是为了创造一个非常高性能的金融交易所。
作为实现这一目标的工作的一部分，我们评估了设计此类系统的几种方法，但是当我们开始测量这些方法时，我们遇到了传统方法的一些基本限制。

许多应用进程依赖队列在处理阶段之间交换数据。
我们的性能测试表明，以这种方式使用队列时，延迟成本对磁盘（基于 RAID 或 SSD 的磁盘系统）的 IO 操作成本处于同一数量级 —— 非常慢。
如果端到端操作中有多个队列，这将增加数百微妙的整体延迟。
显然还有优化的空间。

进一步调查对计算机科学的关注使我们意识到传统方法（例如队列和处理节点）中固有的关注点的混论导致多线程实现中的争用，这表明可能有更好的方法。

考虑现在 CPU 的工作方式，我们喜欢称之为”机械同情“("mechanical sympathy")，使用良好的设计实践，重点关注梳理问题，我们提出了一种数据结构和一种我们称之为 Disruptor 的使用模式。

测试表明，将 Disruptor 用于三级管道的平均延迟比等效的基于队列的方法低 3 个数量级。
此外，对于相同的配置， Disruptor 处理的吞吐量大约高出 8 倍。

这些性能改进代表了围绕并发编程的思想发生了重大变化。
这种新模式是任何需要高吞吐量和低延迟的异步事件处理框架的理想基础。

在 LMAX ，我们创建了一个订单匹配引擎、实施风险管理和一个高可用的内存交易处理系统，所有这些都是在这个模式上取得了巨大的成功。
这些系统中的每一个都设定了新的性能指标，据我们所知，这些标准是无与伦比的。

然而，这不仅与金融行业相关的专业解决方案。
Disruptor 是一种通用机制，它以最大化性能的方式解决并发编程中的复杂问题，并且易于实现。
尽管一些概念可能看起来不寻常，但根据我们的经验，构建这种模式的系统比类似的机制更容易实现。

与同类方法相比， Disruptor 具有更少的写入争用、更低的并发开销并且对缓存更友好，所有这些都导致更高的吞吐量以及更低的延迟和更少的抖动。
在中等时钟速率的处理器上，我们已经看到每秒超过 2500 万消息和低于 50 纳秒的延迟。
与我们见过的任何其他实现相比，这种性能是一个显著的改进。
这非常接近处理器在内核之间交换数据的理论极限。

## 1. 概述 Overview
